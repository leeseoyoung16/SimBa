"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[677],{677:(e,t,l)=>{l.r(t),l.d(t,{default:()=>c});var a=l(338),n=l(43),i=l(674),s=l(579);function r(){var e;const[t]=(0,a.ok)(),l=t.get("missionId"),r=(0,a.Zp)(),c=2e3,[o,d]=(0,n.useState)(null),[h,u]=(0,n.useState)(!0),v=((null===o||void 0===o?void 0:o.role)||"").toString().toUpperCase(),g="REVIEWER"===v||"USER"===v;(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{const{data:t}=await i.Ay.get("/itda/me",{withCredentials:!0});e&&d(t||null)}catch(t){e&&d(null)}finally{e&&u(!1)}})(),()=>{e=!1}},[]);const[m,p]=(0,n.useState)(""),[w,b]=(0,n.useState)(0),[f,x]=(0,n.useState)([]),j=(0,n.useRef)(null),[y,N]=(0,n.useState)(!1),[C,k]=(0,n.useState)("preview"),[U,S]=(0,n.useState)(0);(0,n.useEffect)(()=>()=>{f.forEach(e=>e.previewUrl&&URL.revokeObjectURL(e.previewUrl))},[f]);const R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"preview";f.length&&(k(e),S(0),N(!0))},E=!g||!l||f.length>=10,L=f.length?"".concat(f.length,"\uac1c \uc120\ud0dd\ub428 (\uc11c\ubc84 \uc800\uc7a5\uc740 1\uc7a5)"):"\uc120\ud0dd\ub41c \uc774\ubbf8\uc9c0 \uc5c6\uc74c";return(0,s.jsxs)("div",{className:"review-page",children:[(0,s.jsx)("div",{className:"review-toolbar",children:(0,s.jsx)("h2",{className:"review-title",children:"\ub9ac\ubdf0 \uc791\uc131"})}),(0,s.jsxs)("div",{className:"review-input-container ".concat(g&&l?"":"disabled"),children:[h?(0,s.jsx)("div",{className:"review-guard",children:"\uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}):l?g?null:(0,s.jsx)("div",{className:"review-guard",children:"\ub9ac\ubdf0\uc5b4\ub9cc \ub9ac\ubdf0\ub97c \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}):(0,s.jsx)("div",{className:"review-guard",children:"\uc798\ubabb\ub41c \uc811\uadfc\uc785\ub2c8\ub2e4. (missionId\uac00 \uc5c6\uc2b5\ub2c8\ub2e4)"}),(0,s.jsx)("div",{className:"star-rating",role:"radiogroup","aria-label":"\ubcc4\uc810 \uc120\ud0dd",children:[1,2,3,4,5].map(e=>(0,s.jsx)("button",{type:"button",className:e<=w?"star filled":"star",onClick:()=>b(e),"aria-pressed":e<=w,"aria-label":"".concat(e,"\uc810"),children:"\u2605"},e))}),(0,s.jsx)("textarea",{placeholder:"\ub9ac\ubdf0\ub97c \uc791\uc131\ud574\uc8fc\uc138\uc694. (\ucd5c\uc18c 10\uae00\uc790, \ucd5c\ub300 ".concat(c,"\uae00\uc790)"),className:"review-textarea",value:m,onChange:e=>{const t=(e.target.value||"").slice(0,c);p(t)},maxLength:c,disabled:!g||!l,rows:10,"aria-describedby":"review-length-helper"}),(0,s.jsxs)("div",{id:"review-length-helper",className:"review-length-helper ".concat(m.length>=c?"error":""),"aria-live":"polite",children:[m.length," / ",c,"\uc790"]}),(0,s.jsxs)("div",{className:"review-file-row",children:[(0,s.jsx)("input",{ref:j,id:"review-file",type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);if(!t.length)return;const l=Math.max(0,10-f.length),a=t.slice(0,l);a.length<t.length&&alert("\uc774\ubbf8\uc9c0\ub294 \ucd5c\ub300 10\uc7a5\uae4c\uc9c0 \uc5c5\ub85c\ub4dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.");const n=a.map(e=>({id:"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),file:e,previewUrl:URL.createObjectURL(e)}));x(e=>[...e,...n]),e.target.value=""},className:"review-file-input",disabled:E,title:"\ucd5c\ub300 10\uc7a5\uae4c\uc9c0 \uc120\ud0dd \uac00\ub2a5 (\uc11c\ubc84 \uc800\uc7a5\uc740 1\uc7a5)"}),(0,s.jsxs)("button",{type:"button",className:"review-file-btn",onClick:()=>{var e;return!E&&(null===(e=j.current)||void 0===e?void 0:e.click())},disabled:E,children:[(0,s.jsx)("span",{className:"btn-icon","aria-hidden":!0,children:"\ud83d\uddbc\ufe0f"}),"\uc774\ubbf8\uc9c0 \uc120\ud0dd"]}),(0,s.jsx)("button",{type:"button",className:"preview-btn",onClick:()=>R("preview"),disabled:!g||0===f.length,children:"\ubbf8\ub9ac\ubcf4\uae30"}),(0,s.jsx)("button",{type:"button",className:"preview-btn danger",onClick:()=>R("delete"),disabled:!g||0===f.length,children:"\uc0ad\uc81c"}),(0,s.jsx)("span",{className:"file-name","aria-live":"polite",children:L})]}),(0,s.jsx)("button",{onClick:async()=>{var e;if(!l)return alert("\uc798\ubabb\ub41c \uc811\uadfc\uc785\ub2c8\ub2e4. (missionId \uc5c6\uc74c)");if(!g)return;const t=m.trim();if(t.length<10)return void alert("\ucd5c\uc18c 10\uae00\uc790 \uc774\uc0c1 \uc791\uc131\ud574\uc57c \ud569\ub2c8\ub2e4.");if(t.length>c)return void alert("\ub9ac\ubdf0\ub294 \ucd5c\ub300 ".concat(c,"\uc790\uae4c\uc9c0 \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\ud604\uc7ac ").concat(t.length,"\uc790)"));if(0===w)return void alert("\ubcc4\uc810\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.");const a="/itda/missions/".concat(encodeURIComponent(l),"/reviews"),n=(null===(e=f[0])||void 0===e?void 0:e.file)||null,s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image";const l=new FormData,a={content:t,rating:Number(w)},i=new Blob([JSON.stringify(a)],{type:"application/json"});return l.append("request",i,"request.json"),n&&l.append(e,n,n.name),l},o=e=>i.Ay.post(a,e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:[e=>e]});try{if(n)try{await o(s("image"))}catch(x){var d;const e=null===x||void 0===x||null===(d=x.response)||void 0===d?void 0:d.status;if(400!==e&&415!==e&&422!==e)throw x;try{await o(s("file"))}catch(j){var h;const e=null===j||void 0===j||null===(h=j.response)||void 0===h?void 0:h.status;if(400!==e&&415!==e&&422!==e)throw j;try{await o(s("img"))}catch(y){const e=await fetch(a,{method:"POST",credentials:"include",body:s("image")});if(!e.ok){const t=await e.text().catch(()=>"");throw new Error(t||"\uc5c5\ub85c\ub4dc \uc2e4\ud328 (".concat(e.status,")"))}}}}else await o(s("image"));alert("\ub9ac\ubdf0\uac00 \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),r("/")}catch(N){var u,v,p,b;const e=(null===N||void 0===N||null===(u=N.response)||void 0===u||null===(v=u.data)||void 0===v?void 0:v.message)||(null===N||void 0===N||null===(p=N.response)||void 0===p||null===(b=p.data)||void 0===b?void 0:b.error)||(null===N||void 0===N?void 0:N.message)||"\ub9ac\ubdf0 \ub4f1\ub85d \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(e)}},className:"review-button",disabled:!g||!l,children:"\ub4f1\ub85d"})]}),y&&f.length>0&&(0,s.jsx)("div",{className:"gallery-overlay","aria-modal":"true",role:"dialog",children:(0,s.jsxs)("div",{className:"gallery-sheet small",role:"document",children:[(0,s.jsxs)("div",{className:"gallery-header",children:[(0,s.jsx)("span",{className:"gallery-title",children:"delete"===C?"\uc774\ubbf8\uc9c0 \uc0ad\uc81c":"\uc774\ubbf8\uc9c0 \ubbf8\ub9ac\ubcf4\uae30"}),(0,s.jsx)("button",{type:"button",className:"gallery-close","aria-label":"\ub2eb\uae30",onClick:()=>N(!1)})]}),(0,s.jsxs)("div",{className:"gallery-body",children:[(0,s.jsx)("button",{type:"button",className:"gallery-nav left",onClick:()=>f.length&&S(e=>(e-1+f.length)%f.length),"aria-label":"\uc774\uc804 \uc774\ubbf8\uc9c0",children:"\u2039"}),(0,s.jsx)("img",{src:null===(e=f[U])||void 0===e?void 0:e.previewUrl,alt:"\uc120\ud0dd \uc774\ubbf8\uc9c0 ".concat(U+1,"/").concat(f.length),className:"gallery-image small"}),(0,s.jsx)("button",{type:"button",className:"gallery-nav right",onClick:()=>f.length&&S(e=>(e+1)%f.length),"aria-label":"\ub2e4\uc74c \uc774\ubbf8\uc9c0",children:"\u203a"})]}),(0,s.jsxs)("div",{className:"gallery-footer",children:[(0,s.jsxs)("div",{className:"gallery-count",children:[U+1," / ",f.length]}),"delete"===C&&(0,s.jsx)("button",{type:"button",className:"delete-btn",onClick:()=>{if(!f.length)return;const e=U,t=f[e];null!==t&&void 0!==t&&t.previewUrl&&URL.revokeObjectURL(t.previewUrl);const l=f.filter((t,l)=>l!==e);x(l),l.length?S(e>=l.length?l.length-1:e):N(!1)},children:"\uc0ad\uc81c\ud558\uae30"})]})]})})]})}function c(){return(0,s.jsx)("div",{"data-app":"map",children:(0,s.jsxs)(a.BV,{children:[(0,s.jsx)(a.qh,{index:!0,element:(0,s.jsx)(r,{})}),(0,s.jsx)(a.qh,{path:"*",element:(0,s.jsx)(a.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=677.88590470.chunk.js.map