"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[822],{822:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var l=s(338),i=s(379),t=s(43),n=s(674),d=s(579);const r=["ALL","ISSUED","USED","EXPIRED"],c={withCredentials:!0};function o(){var e,a;const s=(0,l.KC)(),o=null!==s&&void 0!==s&&null!==(e=s.user)&&void 0!==e&&e.id?s.user:null,[m,u]=(0,t.useState)(o),[v,p]=(0,t.useState)(!o),[h,y]=(0,t.useState)([]),[g,x]=(0,t.useState)(!1),[N,j]=(0,t.useState)([]),[S,b]=(0,t.useState)(!1),[f,w]=(0,t.useState)("ISSUED"),E=(null===m||void 0===m?void 0:m.email)||"",A=((null===m||void 0===m?void 0:m.name)||(null===m||void 0===m?void 0:m.email)||"U").toString().slice(0,1).toUpperCase(),D=(null===m||void 0===m?void 0:m.username)||(null===m||void 0===m?void 0:m.name)||(null===m||void 0===m?void 0:m.email)||"\uc0ac\uc6a9\uc790";(0,t.useEffect)(()=>{let e=!0;return(async()=>{try{var a;if(null!==s&&void 0!==s&&null!==(a=s.user)&&void 0!==a&&a.id)return void(e&&(u(s.user),p(!1)));p(!0);const{data:l}=await n.Ay.get("/itda/me",c);e&&u(null!==l&&void 0!==l&&l.id?l:null)}catch(l){e&&u(null)}finally{e&&p(!1)}})(),()=>{e=!1}},[null===s||void 0===s||null===(a=s.user)||void 0===a?void 0:a.id]),(0,t.useEffect)(()=>{if(null===m||void 0===m||!m.id)return;let e=!0;return(async()=>{try{x(!0);const{data:a}=await n.Ay.get("/itda/reviews",(0,i.A)({params:{userId:m.id}},c));e&&y(Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[])}catch(a){e&&y([])}finally{e&&x(!1)}})(),()=>{e=!1}},[null===m||void 0===m?void 0:m.id]);const I=e=>{if(null===e||void 0===e||""===e)return"-";if("number"===typeof e){const a=new Date(e>1e12?e:1e3*e);return isNaN(a.getTime())?"-":a.toISOString().slice(0,10)}const a=String(e).trim();if(!a)return"-";const s=new Date(a);return isNaN(s.getTime())?a.slice(0,10):s.toISOString().slice(0,10)},U=async e=>{if(null===m||void 0===m||!m.id)return;b(!0);const a=(e,a)=>e.map(e=>{var s,l,t,n,d,r,c,o,m,u,v,p,h,y,g,x,N,j,S,b;const f=null!==(s=null!==(l=null!==(t=null!==(n=null!==(d=e.id)&&void 0!==d?d:e.voucherId)&&void 0!==n?n:e.voucherID)&&void 0!==t?t:e.uuid)&&void 0!==l?l:e.code)&&void 0!==s?s:e._id,w=(e.vstatus||e.status||a||"ISSUED").toString().toUpperCase(),E=w,A=e.storeName||(null===(r=e.store)||void 0===r?void 0:r.name)||(null===(c=e.mission)||void 0===c?void 0:c.storeName)||(null===(o=e.mission)||void 0===o||null===(m=o.store)||void 0===m?void 0:m.name)||"",D=e.rewardContent||e.rewardName||e.title||e.name,I="".concat(A?"[".concat(A,"] "):"").concat(D),U=null!==(u=null!==(v=null!==(p=null!==(h=null!==(y=e.validFrom)&&void 0!==y?y:e.startAt)&&void 0!==h?h:e.start_date)&&void 0!==p?p:e.startDate)&&void 0!==v?v:e.issuedAt)&&void 0!==u?u:null,C=null!==(g=null!==(x=null!==(N=null!==(j=null!==(S=null!==(b=e.validTo)&&void 0!==b?b:e.endAt)&&void 0!==S?S:e.end_date)&&void 0!==j?j:e.endDate)&&void 0!==N?N:e.expireAt)&&void 0!==x?x:e.expirationDate)&&void 0!==g?g:null;return(0,i.A)((0,i.A)({},e),{},{id:f,status:E,storeName:A,title:I,start:U,end:C})});try{const s=e||f||"ISSUED";if("ALL"===s){const e=["ISSUED","USED","EXPIRED"],s=await Promise.all(e.map(e=>n.Ay.get("/itda/me/vouchers",(0,i.A)({params:{filter:e}},c)).then(e=>{let{data:a}=e;return Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[]}).catch(()=>[]))),l=[...s[0],...s[1],...s[2]],t=new Set,d=l.filter(e=>{var a,s,l,i;const n=null!==(a=null!==(s=null!==(l=null!==(i=e.id)&&void 0!==i?i:e.voucherId)&&void 0!==l?l:e.uuid)&&void 0!==s?s:e.code)&&void 0!==a?a:e._id;return!t.has(n)&&(t.add(n),!0)});j(a(d,"ALL"))}else{const{data:e}=await n.Ay.get("/itda/me/vouchers",(0,i.A)({params:{filter:s}},c)),l=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.items)||[];j(a(l,s))}}catch(s){j([])}finally{b(!1)}};(0,t.useEffect)(()=>{null!==m&&void 0!==m&&m.id&&U(f)},[null===m||void 0===m?void 0:m.id,f]);const C=(0,t.useMemo)(()=>({ALL:{label:"\uc804\uccb4",chip:""},ISSUED:{label:"\ubc1c\uae09",chip:"success"},USED:{label:"\uc0ac\uc6a9",chip:"warn"},EXPIRED:{label:"\ub9cc\ub8cc",chip:"muted"}}),[]),k=(0,t.useMemo)(()=>({APPROVED:{label:"\uc2b9\uc778\ub428",chip:"success"},PENDING:{label:"\ub300\uae30\uc911",chip:"warn"},REJECTED:{label:"\ube44\uc2b9\uc778",chip:"muted"}}),[]);return(0,d.jsxs)("div",{className:"mypage-root",children:[(0,d.jsxs)("header",{className:"mypage-header",children:[(0,d.jsx)("div",{className:"logo-text",children:"\ub9ac\ubdf0\uc5b4 \ub9c8\uc774\ud398\uc774\uc9c0"}),(0,d.jsxs)("div",{className:"mypage-user",children:[(0,d.jsxs)("div",{className:"mypage-user-meta",children:[(0,d.jsx)("span",{className:"mypage-user-name",children:D}),E&&(0,d.jsx)("span",{className:"mypage-user-mail",children:E})]}),(0,d.jsx)("div",{className:"mypage-avatar","aria-hidden":!0,children:A})]})]}),(0,d.jsxs)("main",{className:"mypage-main",children:[(0,d.jsxs)("section",{className:"mypage-section","aria-label":"\ub9ac\ubdf0 \ubaa9\ub85d",children:[(0,d.jsx)("div",{className:"mypage-section-head",children:(0,d.jsx)("h2",{className:"mypage-section-title",children:"\ub9ac\ubdf0 \ubaa9\ub85d"})}),(0,d.jsx)("div",{className:"mypage-list",children:g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"mypage-card mypage-skeleton"}),(0,d.jsx)("div",{className:"mypage-card mypage-skeleton"})]}):0===h.length?(0,d.jsx)("div",{className:"mypage-empty",children:"\uc544\uc9c1 \uc791\uc131\ud55c \ub9ac\ubdf0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):h.map(e=>{const a=(e.status||"").toString().toUpperCase(),s=k[a]||k.PENDING;return(0,d.jsxs)("article",{className:"mypage-card",children:[(0,d.jsxs)("div",{className:"mypage-store",children:[(0,d.jsx)("div",{className:"mypage-store-thumb","aria-hidden":!0,children:"\ud83d\udcf7"}),(0,d.jsx)("div",{className:"mypage-store-info",children:(0,d.jsx)("div",{className:"mypage-store-name",children:e.storeName})})]}),(0,d.jsxs)("div",{className:"mypage-review",children:[(0,d.jsx)("div",{className:"mypage-avatar sm","aria-hidden":!0,children:"\ud83d\udc64"}),(0,d.jsxs)("div",{className:"mypage-review-body",children:[(0,d.jsxs)("div",{className:"mypage-review-meta",children:[(0,d.jsx)("span",{className:"mypage-review-author",children:D}),(0,d.jsx)("span",{className:"mypage-chip ".concat(s.chip),children:s.label})]}),e.content&&(0,d.jsx)("p",{className:"mypage-review-text",children:e.content})]})]})]},e.id)})})]}),(0,d.jsxs)("section",{className:"mypage-section","aria-label":"\ubc14\uc6b0\ucc98 \ubaa9\ub85d",children:[(0,d.jsxs)("div",{className:"mypage-section-head",children:[(0,d.jsx)("h2",{className:"mypage-section-title",children:"\ubc14\uc6b0\ucc98 \ubaa9\ub85d"}),(0,d.jsx)("div",{className:"mypage-tabs",role:"tablist","aria-label":"\ubc14\uc6b0\ucc98 \uc0c1\ud0dc \ud544\ud130",children:r.map(e=>{var a;return(0,d.jsx)("button",{type:"button",className:"mypage-tab ".concat(f===e?"active":""),role:"tab","aria-selected":f===e,onClick:()=>w(e),children:(null===(a=C[e])||void 0===a?void 0:a.label)||e},e)})})]}),(0,d.jsx)("div",{className:"mypage-list",children:S?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"mypage-card mypage-skeleton"}),(0,d.jsx)("div",{className:"mypage-card mypage-skeleton"})]}):0===N.length?(0,d.jsx)("div",{className:"mypage-empty",children:"\ud574\ub2f9 \uc0c1\ud0dc\uc758 \ubc14\uc6b0\ucc98\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):N.map(e=>{var a,s;const l=C[e.status]||C.ISSUED;return(0,d.jsxs)("article",{className:"mypage-card mypage-reward",children:[(0,d.jsxs)("div",{className:"mypage-reward-left",children:[(0,d.jsx)("div",{className:"mypage-chip ".concat(l.chip),children:null!==(a=null===(s=C[e.status])||void 0===s?void 0:s.label)&&void 0!==a?a:l.label}),(0,d.jsxs)("div",{className:"mypage-reward-body",children:[(0,d.jsx)("div",{className:"mypage-reward-title",children:e.title}),(0,d.jsxs)("div",{className:"mypage-reward-period",children:[e.start||e.end?(0,d.jsxs)(d.Fragment,{children:["\uc0ac\uc6a9\uae30\uac04: ",I(e.start)," ~ ",I(e.end)]}):(0,d.jsx)(d.Fragment,{children:"\uc0ac\uc6a9\uae30\uac04: -"}),(0,d.jsxs)("span",{className:"mypage-reward-place",children:[" ","\xb7 \uc0ac\uc6a9\ucc98: ",e.storeName||"-"]})]})]})]}),"ISSUED"===e.status&&(0,d.jsx)("button",{type:"button",className:"mypage-btn use",onClick:()=>(async e=>{if(e&&window.confirm("\uc774 \ubc14\uc6b0\ucc98\ub97c \uc0ac\uc6a9 \ucc98\ub9ac\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))try{await n.Ay.patch("/itda/me/vouchers/".concat(e,"/use"),null,c),U(f)}catch(l){var a,s;const e=(null===l||void 0===l||null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||(null===l||void 0===l?void 0:l.message)||"\uc0ac\uc6a9 \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(e)}})(e.id),title:"\ubc14\uc6b0\ucc98 \uc0ac\uc6a9 \ucc98\ub9ac",children:"\uc0ac\uc6a9 \ucc98\ub9ac"})]},e.id)})})]})]})]})}function m(){return(0,d.jsx)("div",{"data-app":"map",children:(0,d.jsxs)(l.BV,{children:[(0,d.jsx)(l.qh,{index:!0,element:(0,d.jsx)(o,{})}),(0,d.jsx)(l.qh,{path:"*",element:(0,d.jsx)(l.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=822.660a30f5.chunk.js.map