"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[393],{393:(e,l,t)=>{t.r(l),t.d(l,{default:()=>m});var n=t(43),s=t(338),d=t(674),a=t(950),i=t(579);function o(e){let{open:l,defaultAddress:t="",onClose:s,onConfirm:d}=e;const o=(0,n.useRef)(null),r=(0,n.useRef)(null),u=(0,n.useRef)(null),c=(0,n.useRef)(null),v=(0,n.useRef)(null),m=(0,n.useRef)(null),[p,h]=(0,n.useState)(t),[x,g]=(0,n.useState)({lat:null,lng:null}),[f,y]=(0,n.useState)(""),[j,b]=(0,n.useState)(""),[w,N]=(0,n.useState)(null),[k,C]=(0,n.useState)(""),S={lat:37.5665,lng:126.978},A=async()=>{var e;if(null===(e=window.kakao)||void 0===e||!e.maps)return void N("Kakao Maps SDK\uac00 \ub85c\ub4dc\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. index.html\uc744 \ud655\uc778\ud558\uc138\uc694.");if(!window.kakao.maps.services)return void N("Kakao Maps services \ub77c\uc774\ube0c\ub7ec\ub9ac\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. SDK URL\uc5d0 libraries=services\ub97c \ud3ec\ud568\ud558\uc138\uc694.");N(null);const l=await new Promise(e=>{if(!navigator.geolocation)return e(S);navigator.geolocation.getCurrentPosition(l=>e({lat:l.coords.latitude,lng:l.coords.longitude}),()=>e(S),{enableHighAccuracy:!0,timeout:5e3})}),t=window.kakao,n=new t.maps.LatLng(l.lat,l.lng),s=new t.maps.Map(r.current,{center:n,level:3});c.current=s;const d=new t.maps.Marker({position:n,draggable:!0});d.setMap(s),v.current=d,m.current=new t.maps.services.Geocoder,g(l),E(l),setTimeout(()=>{s.relayout(),s.setCenter(d.getPosition())},0),t.maps.event.addListener(d,"dragend",()=>{const e=d.getPosition(),l={lat:e.getLat(),lng:e.getLng()};g(l),E(l),s.setCenter(e)})};(0,n.useEffect)(()=>{l&&(C(""),A())},[l]),(0,n.useEffect)(()=>{if(!l)return;const e=document.body,t=window.scrollY;e.style.position="fixed",e.style.top="-".concat(t,"px"),e.style.left="0",e.style.right="0";const n=e=>{"Escape"===e.key&&(null===s||void 0===s||s())};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n),e.style.position="",e.style.top="",e.style.left="",e.style.right="",window.scrollTo(0,t)}},[l,s]);const E=e=>{let{lat:l,lng:t}=e;const n=m.current;n&&n.coord2Address(t,l,(e,l)=>{var t,n,s,d;if(l!==window.kakao.maps.services.Status.OK||null===e||void 0===e||!e[0])return;const a=(null===(t=e.find(e=>e.road_address))||void 0===t||null===(n=t.road_address)||void 0===n?void 0:n.address_name)||"",i=(null===(s=e[0])||void 0===s||null===(d=s.address)||void 0===d?void 0:d.address_name)||"";y(a),b(i),h(a||i||"")})},L=e=>{if(null===e||void 0===e||!e.trim())return;const l=m.current;l&&l.addressSearch(e.trim(),(e,l)=>{if(l!==window.kakao.maps.services.Status.OK||null===e||void 0===e||!e[0])return;const{y:t,x:n,road_address:s,address:d}=e[0],a={lat:parseFloat(t),lng:parseFloat(n)};g(a),y((null===s||void 0===s?void 0:s.address_name)||""),b((null===d||void 0===d?void 0:d.address_name)||"");const i=new window.kakao.maps.LatLng(a.lat,a.lng);v.current.setPosition(i),c.current.setCenter(i)})},R=()=>{u.current&&(u.current.style.display="none")};return l?(0,a.createPortal)((0,i.jsx)("div",{ref:o,className:"addr-modal-overlay",onClick:e=>{e.target===o.current&&(null===s||void 0===s||s())},children:(0,i.jsxs)("div",{className:"addr-modal-container",role:"dialog","aria-modal":"true","aria-label":"\uc8fc\uc18c \uc120\ud0dd",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"addr-modal-header",children:(0,i.jsx)("strong",{children:"\uc8fc\uc18c \uc120\ud0dd"})}),(0,i.jsxs)("div",{className:"addr-modal-body",children:[w&&(0,i.jsx)("div",{className:"addr-error",children:w}),(0,i.jsxs)("div",{className:"addr-search-row",children:[(0,i.jsx)("input",{type:"text",className:"addr-input",placeholder:"\uc8fc\uc18c\ub97c \uc785\ub825\ud558\uc138\uc694 (\uc608: \uc11c\uc6b8\ud2b9\ubcc4\uc2dc \uc911\uad6c \uc138\uc885\ub300\ub85c 110)",value:k,onChange:e=>C(e.target.value),onKeyDown:e=>{"Enter"===e.key&&L(k)}}),(0,i.jsx)("button",{type:"button",className:"addr-btn",onClick:()=>L(k),children:"\uc8fc\uc18c\uac80\uc0c9"}),(0,i.jsx)("button",{type:"button",className:"addr-btn",onClick:()=>{var e;if(null===(e=window.daum)||void 0===e||!e.Postcode)return void N("\ub2e4\uc74c \uc6b0\ud3b8\ubc88\ud638 SDK\uac00 \ub85c\ub4dc\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. index.html\uc744 \ud655\uc778\ud558\uc138\uc694.");u.current.style.display="block";const l=document.getElementById("addr-postcode-embed");l.innerHTML="";new window.daum.Postcode({oncomplete:e=>{const l=e.roadAddress||e.jibunAddress||"";h(l),C(l),L(l),R()},width:"100%",height:"100%"}).embed(l,{autoClose:!1})},children:"\uc6b0\ud3b8\ubc88\ud638"})]}),(0,i.jsx)("div",{ref:r,className:"addr-map"}),(0,i.jsxs)("div",{ref:u,className:"addr-postcode-layer",style:{display:"none"},children:[(0,i.jsxs)("div",{className:"addr-postcode-header",children:[(0,i.jsx)("span",{children:"\uc6b0\ud3b8\ubc88\ud638 \uac80\uc0c9"}),(0,i.jsx)("button",{type:"button",className:"addr-btn small",onClick:R,children:"\ub2eb\uae30"})]}),(0,i.jsx)("div",{id:"addr-postcode-embed",className:"addr-postcode-embed"})]}),(0,i.jsxs)("div",{className:"addr-info-row",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"addr-info-title",children:"\ub3c4\ub85c\uba85"}),(0,i.jsx)("div",{children:f||"-"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"addr-info-title",children:"\uc9c0\ubc88"}),(0,i.jsx)("div",{children:j||"-"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"addr-info-title",children:"\uc88c\ud45c"}),(0,i.jsx)("div",{children:null!=x.lat&&null!=x.lng?(0,i.jsxs)(i.Fragment,{children:[x.lat.toFixed(6),", ",x.lng.toFixed(6)]}):"-"})]})]})]}),(0,i.jsxs)("div",{className:"addr-modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"addr-btn",onClick:s,children:"\ucde8\uc18c"}),(0,i.jsx)("button",{type:"button",className:"addr-btn confirm",onClick:()=>null===d||void 0===d?void 0:d({address:p,roadAddress:f,jibunAddress:j,latitude:x.lat,longitude:x.lng}),disabled:!p||null==x.lat||null==x.lng,children:"\ud655\uc778"})]})]})}),document.body):null}const r=function(){var e,l,t,n;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null!==(e=null!==(l=null!==(t=null!==(n=null===s||void 0===s?void 0:s.name)&&void 0!==n?n:null===s||void 0===s?void 0:s.storeName)&&void 0!==t?t:null===s||void 0===s?void 0:s.title)&&void 0!==l?l:null===s||void 0===s?void 0:s.shopName)&&void 0!==e?e:""},u=e=>{if(null===e||void 0===e||""===e)return null;const l="string"===typeof e?Number(e):e;return Number.isFinite(l)?l:null};const c=function(){var e;const l=(0,s.g)(),t=(0,s.zy)(),a=(0,s.Zp)(),c=null===l||void 0===l?void 0:l.id,v=new URLSearchParams(t.search).get("id"),m=null===(e=t.state)||void 0===e?void 0:e.id,p=t.pathname.split("/").filter(Boolean).pop(),h=/^\d+$/.test(p)?p:null,x=c||v||m||h||null,g=null!=x?String(x):null,f=!!g,{user:y}=(0,s.KC)()||{},j=(null===y||void 0===y?void 0:y.name)||(null===y||void 0===y?void 0:y.nickname)||(null===y||void 0===y?void 0:y.username)||(null===y||void 0===y?void 0:y.displayName)||"",[b,w]=(0,n.useState)(""),[N,k]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[A,E]=(0,n.useState)(""),[L,R]=(0,n.useState)({lat:null,lng:null}),[P,F]=(0,n.useState)(j),[K,T]=(0,n.useState)(!1),[_,M]=(0,n.useState)(!1),[D,U]=(0,n.useState)(null),[q,B]=(0,n.useState)(f),[I,O]=(0,n.useState)(""),H=e=>{if(null===e||void 0===e||""===e)return"";const l=String(e).trim().toUpperCase();if("CAFE"===l)return"0";if("RESTAURANT"===l)return"1";if("ETC"===l)return"2";if(["0","1","2"].includes(l))return l;const t=Number(l);return Number.isInteger(t)&&t>=0&&t<=2?String(t):""},z=e=>(e||"").replace(/[^0-9]/g,""),G=()=>{var e,l,n,s;const d=t.state||{};if(!d||"object"!==typeof d)return;w(e=>e||r(d)),k(e=>{var l;return e||(null!==(l=d.businessNumber)&&void 0!==l?l:"")}),S(e=>{var l;return e||(null!==(l=d.address)&&void 0!==l?l:"")}),E(e=>""!==e?e:H(d.category));const a=u(null!==(e=null!==(l=d.latitude)&&void 0!==l?l:d.lat)&&void 0!==e?e:d.y),i=u(null!==(n=null!==(s=d.longitude)&&void 0!==s?s:d.lng)&&void 0!==n?n:d.x);R(e=>{var l,t;return{lat:null!==(l=e.lat)&&void 0!==l?l:a,lng:null!==(t=e.lng)&&void 0!==t?t:i}})};return(0,n.useEffect)(()=>{f||F(e=>e||j)},[f,j]),(0,n.useEffect)(()=>{f&&G()},[f]),(0,n.useEffect)(()=>{let e=!0;return f?((async()=>{try{var l,t;B(!0),O("");const{data:n}=await d.Ay.get("/itda/stores/".concat(g));if(!e)return;w(r(n)),k((null===n||void 0===n?void 0:n.businessNumber)||""),S((null===n||void 0===n?void 0:n.address)||""),E(H(null===n||void 0===n?void 0:n.category));const s=u(null!==(l=null===n||void 0===n?void 0:n.latitude)&&void 0!==l?l:null===n||void 0===n?void 0:n.lat),a=u(null!==(t=null===n||void 0===n?void 0:n.longitude)&&void 0!==t?t:null===n||void 0===n?void 0:n.lng);R({lat:s,lng:a});const i=(null===n||void 0===n?void 0:n.ownerName)||(null===n||void 0===n?void 0:n.bossName)||"";F(i||j||"")}catch(i){var n,s,a;const e=null===i||void 0===i||null===(n=i.response)||void 0===n?void 0:n.status,l=(null===i||void 0===i||null===(s=i.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||(null===i||void 0===i?void 0:i.message)||"\uac00\uac8c \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.";O("[".concat(null!==e&&void 0!==e?e:"ERR","] ").concat(l," (\uc694\uccad: /itda/stores/").concat(g,")")),G(),console.warn("load store failed:",i)}finally{e&&B(!1)}})(),()=>{e=!1}):(B(!1),O(""),()=>{e=!1})},[g,f,j]),(0,i.jsxs)("div",{className:"itda-edit",children:[f&&q?(0,i.jsx)("div",{className:"loader",children:"\uac00\uac8c \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}):f&&I?(0,i.jsx)("div",{className:"error",children:I}):(0,i.jsxs)("form",{className:"row",onSubmit:async e=>{if(e.preventDefault(),U(null),!b.trim()||!N.trim()||!C.trim()||""===A)return void U({type:"error",text:"\ubaa8\ub4e0 \ud56d\ubaa9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."});if(10!==z(N).length)return void U({type:"error",text:"\uc0ac\uc5c5\uc790\ub4f1\ub85d\ubc88\ud638\ub294 \uc22b\uc790 10\uc790\ub9ac\uc5ec\uc57c \ud569\ub2c8\ub2e4. (\ud558\uc774\ud508 \uc81c\uc678)"});const l=H(A);if(""===l)return void U({type:"error",text:"\uc5c5\uc885\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."});const t={name:b.trim(),category:parseInt(l,10),businessNumber:z(N),address:C.trim(),latitude:L.lat,longitude:L.lng};try{var n;M(!0);const e=f?await d.Ay.put("/itda/stores/".concat(g),t):await d.Ay.post("/itda/stores",t),l=(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||(f?"\uc218\uc815\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.":"\ub4f1\ub85d\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.");U({type:"success",text:l}),a("/manage",{replace:!0})}catch(o){var s,i;const e=(null===o||void 0===o||null===(s=o.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||(null===o||void 0===o?void 0:o.message)||(f?"\uc218\uc815 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.":"\ub4f1\ub85d \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.");U({type:"error",text:e})}finally{M(!1)}},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"\uc0c1\ud638\uba85"}),(0,i.jsx)("input",{className:"input ".concat(""===b?"is-placeholder":""),type:"text",value:b,placeholder:"\uc0c1\ud638\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.",onChange:e=>w(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"\uc5c5\uc885"}),(0,i.jsxs)("select",{className:"input ".concat(""===A?"is-placeholder":""),value:A,onChange:e=>E(e.target.value),children:[(0,i.jsx)("option",{value:"",disabled:!0,hidden:!0,children:"\uc5c5\uc885"}),[{value:0,label:"\uce74\ud398"},{value:1,label:"\uc2dd\ub2f9"},{value:2,label:"\uae30\ud0c0"}].map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"\uc0ac\uc5c5\uc790\ub4f1\ub85d\ubc88\ud638"}),(0,i.jsx)("input",{className:"input ".concat(""===N?"is-placeholder":""),type:"text",value:N,placeholder:"\uc0ac\uc5c5\uc790\ub4f1\ub85d\ubc88\ud638\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694. (\uc608: 123-45-67890)",onChange:e=>k(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"\uc8fc\uc18c"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("input",{className:"input ".concat(""===C?"is-placeholder":""),type:"text",value:C,placeholder:"\uc8fc\uc18c\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694.",readOnly:!0,onClick:()=>T(!0)}),(0,i.jsx)("button",{type:"button",className:"btn",onClick:()=>T(!0),children:"\uc8fc\uc18c \uc120\ud0dd"})]}),null!=L.lat&&null!=L.lng&&(0,i.jsxs)("small",{style:{color:"#666"},children:["\uc120\ud0dd \uc88c\ud45c: ",Number(L.lat).toFixed(6),", ",Number(L.lng).toFixed(6)]})]}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsx)("button",{type:"submit",className:"btn",disabled:_,children:_?f?"\uc218\uc815 \uc911...":"\ub4f1\ub85d \uc911...":f?"\uc218\uc815 \uc644\ub8cc":"\uc644\ub8cc"})}),D&&(0,i.jsx)("p",{className:"message ".concat("error"===D.type?"error":"success"),style:{marginTop:8},children:D.text})]}),(0,i.jsx)(o,{open:K,defaultAddress:C,onClose:()=>T(!1),onConfirm:e=>{let{address:l,latitude:t,longitude:n}=e;S(l||""),R({lat:t,lng:n}),T(!1)}})]})};const v=function(){return(0,i.jsx)("div",{children:(0,i.jsx)(c,{})})};function m(){return(0,i.jsx)("div",{"data-app":"editshop",children:(0,i.jsxs)(s.BV,{children:[(0,i.jsx)(s.qh,{index:!0,element:(0,i.jsx)(v,{})}),(0,i.jsx)(s.qh,{path:"inner",element:(0,i.jsx)(c,{})}),(0,i.jsx)(s.qh,{path:"*",element:(0,i.jsx)(s.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=393.28f65970.chunk.js.map