"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[486],{486:(a,e,s)=>{s.r(e),s.d(e,{default:()=>u});var t=s(338),l=s(379),r=s(43),i=s(674),n=s(579);const d={headers:{"Content-Type":"application/json"},withCredentials:!0},c={myStores:["/itda/me/stores","/itda/stores"],storeReviews:()=>"/itda/reviews",reviewApprove:a=>({method:"patch",url:"/itda/reviews/".concat(a,"/status"),config:(0,l.A)({params:{status:"APPROVED"}},d)}),reviewReject:a=>({method:"patch",url:"/itda/reviews/".concat(a,"/status"),config:(0,l.A)({params:{status:"REJECTED"}},d)})},o=a=>{if(!a)return"-";const[e,s,t]=String(a).split("-");return e&&s&&t?"".concat(e,".").concat(s,".").concat(t):String(a)};function v(){var a,e;const{user:s}=(0,t.KC)()||{},d=(0,t.Zp)();(0,r.useEffect)(()=>{const a=((null===s||void 0===s?void 0:s.role)||"").toString().toUpperCase();s&&"OWNER"!==a&&(alert("\uc0ac\uc7a5\ub2d8 \uc804\uc6a9 \ud398\uc774\uc9c0\uc785\ub2c8\ub2e4."),d("/",{replace:!0}))},[s,d]);const[v,u]=(0,r.useState)([]),[m,p]=(0,r.useState)(!0),[h,N]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[j,y]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[A,E]=(0,r.useState)(""),[P,k]=(0,r.useState)("PENDING"),[D,w]=(0,r.useState)(null),[C,I]=(0,r.useState)(!1),[R,S]=(0,r.useState)(null),[G,M]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let a=!0;return(async()=>{try{p(!0),N("");let l=[];try{const{data:a}=await i.Ay.get(c.myStores[0]);l=Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[]}catch(n){var e;const{data:a}=await i.Ay.get(c.myStores[1]);l=Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[],null!==s&&void 0!==s&&s.id&&l.length&&null!=(null===(e=l[0])||void 0===e?void 0:e.ownerId)&&(l=l.filter(a=>String(a.ownerId)===String(s.id)))}if(!a)return;var t;if(u(l),l.length>0)g(String(null!==(t=l[0].id)&&void 0!==t?t:l[0].storeId))}catch(d){var l,r;if(!a)return;N((null===d||void 0===d||null===(l=d.response)||void 0===l||null===(r=l.data)||void 0===r?void 0:r.message)||"\ub9e4\uc7a5 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4."),u([])}finally{a&&p(!1)}})(),()=>{a=!1}},[null===s||void 0===s?void 0:s.id]);const O=a=>{var e,s,t,l,r,i,n,d,c,o,v,u,m,p,h,N,x,g;let j=(a.status||"").toString().toUpperCase();if(!j){j=!0===a.approved||!!a.approvedAt?"APPROVED":"PENDING"}const y=null!==(e=null!==(s=a.rating)&&void 0!==s?s:a.stars)&&void 0!==e?e:0,b="number"===typeof y?y:Number(y)||0;let f=[];return Array.isArray(a.images)?f=a.images.filter(Boolean):a.imgUrl&&(f=[a.imgUrl]),{id:null!==(t=a.id)&&void 0!==t?t:a.reviewId,userId:null!==(l=null!==(r=null!==(i=null!==(n=a.userId)&&void 0!==n?n:a.reviewerId)&&void 0!==i?i:a.writerId)&&void 0!==r?r:null===(d=a.user)||void 0===d?void 0:d.id)&&void 0!==l?l:a.accountId,userName:null!==(c=null!==(o=null!==(v=null!==(u=a.userName)&&void 0!==u?u:a.nickname)&&void 0!==v?v:a.username)&&void 0!==o?o:null===(m=a.user)||void 0===m?void 0:m.name)&&void 0!==c?c:"\uc0ac\uc6a9\uc790",rating:b,text:null!==(p=null!==(h=a.text)&&void 0!==h?h:a.content)&&void 0!==p?p:"",date:null!==(N=null!==(x=null!==(g=a.date)&&void 0!==g?g:a.createdAt)&&void 0!==x?x:a.created_at)&&void 0!==N?N:"",images:f,status:j}},V=async a=>{if(a){f(!0),E("");try{const{data:e}=await i.Ay.get(c.storeReviews(),{params:{storeId:a}}),s=(Array.isArray(e)?e:(null===e||void 0===e?void 0:e.items)||[]).map(O);y(s),w(((a,e)=>{var s,t,l;const r=null!==(s=null===a||void 0===a?void 0:a.total)&&void 0!==s?s:null===a||void 0===a?void 0:a.count,i=null!==(t=null!==(l=null===a||void 0===a?void 0:a.avgRating)&&void 0!==l?l:null===a||void 0===a?void 0:a.averageRating)&&void 0!==t?t:null===a||void 0===a?void 0:a.avg,n="number"===typeof r?r:e.length,d="number"===typeof i?i:e.reduce((a,e)=>a+(Number(e.rating)||0),0)/(e.length||1);return{total:n,avgRating:Math.round(10*(d||0))/10}})(e,s))}catch(t){var e,s;y([]),w({total:0,avgRating:0}),E((null===t||void 0===t||null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"\ub9ac\ubdf0\ub97c \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.")}finally{f(!1)}}};(0,r.useEffect)(()=>{x&&V(x)},[x]);const T=(0,r.useMemo)(()=>{const a=(P||"").toUpperCase();return"ALL"===a?j:"APPROVED"===a?j.filter(a=>"PENDING"!==a.status):j.filter(e=>e.status===a)},[j,P]),U=a=>{S(a),I(!0)},J=()=>{G||(I(!1),S(null))},L=(a,e)=>i.Ay.patch(a,null,e);return(0,n.jsxs)("div",{className:"rvap-root",children:[(0,n.jsxs)("header",{className:"rvap-head",children:[(0,n.jsx)("h1",{className:"rvap-title",children:"\ub9ac\ubdf0 \ud655\uc778 \ubc0f \uc644\ub8cc\ucc98\ub9ac"}),(0,n.jsxs)("div",{className:"rvap-controls",children:[(0,n.jsx)("select",{className:"rvap-select",value:x,onChange:a=>g(a.target.value),disabled:m||0===v.length,children:v.map(a=>{var e;const s=null!==(e=a.id)&&void 0!==e?e:a.storeId;return(0,n.jsx)("option",{value:s,children:a.name||a.storeName||"\ub9e4\uc7a5#".concat(s)},s)})}),(0,n.jsx)("div",{className:"rvap-tabs",role:"tablist","aria-label":"\ub9ac\ubdf0 \uc0c1\ud0dc",children:[{key:"ALL",label:"\ubaa8\ub4e0 \ub9ac\ubdf0"},{key:"PENDING",label:"\uac80\uc218 \ub300\uae30"},{key:"APPROVED",label:"\uac80\uc218 \uc644\ub8cc"}].map(a=>(0,n.jsx)("button",{type:"button",className:"rvap-tab ".concat(P===a.key?"active":""),role:"tab","aria-selected":P===a.key,onClick:()=>k(a.key),children:a.label},a.key))})]})]}),!m&&!h&&x&&(0,n.jsx)("section",{className:"rvap-summary",children:b?(0,n.jsx)("div",{className:"rvap-chip muted",children:"\uc694\uc57d \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}):D?(0,n.jsxs)("div",{className:"rvap-summary-grid",children:[(0,n.jsxs)("div",{className:"rvap-summary-item",children:["\ucd1d \ub9ac\ubdf0: ",null!==(a=D.total)&&void 0!==a?a:"-"]}),(0,n.jsxs)("div",{className:"rvap-summary-item",children:["\ud3c9\uade0 \ubcc4\uc810: ",null!==(e=D.avgRating)&&void 0!==e?e:"-"]})]}):(0,n.jsx)("div",{className:"rvap-chip muted",children:"\uc694\uc57d \uc5c6\uc74c"})}),m&&(0,n.jsx)("div",{className:"rvap-empty",children:"\ub9e4\uc7a5 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}),!m&&h&&(0,n.jsx)("div",{className:"rvap-error",children:h}),!m&&!h&&(0,n.jsx)("section",{className:"rvap-list",children:b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"rvap-card rvap-skeleton"}),(0,n.jsx)("div",{className:"rvap-card rvap-skeleton"})]}):A?(0,n.jsx)("div",{className:"rvap-error",children:A}):0===T.length?(0,n.jsx)("div",{className:"rvap-empty",children:"\ud574\ub2f9 \uc0c1\ud0dc\uc758 \ub9ac\ubdf0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):T.map(a=>(0,n.jsxs)("article",{className:"rvap-card ".concat("PENDING"===a.status?"rvap-clickable":""),onClick:()=>"PENDING"===a.status&&U(a),role:"PENDING"===a.status?"button":void 0,tabIndex:"PENDING"===a.status?0:void 0,onKeyDown:e=>((a,e)=>{"PENDING"===e.status&&("Enter"!==a.key&&" "!==a.key||(a.preventDefault(),U(e)))})(e,a),"aria-label":"PENDING"===a.status?"\ub9ac\ubdf0 \uce74\ub4dc: \ud074\ub9ad\ud558\uc5ec \uac80\uc218":void 0,children:[(0,n.jsxs)("div",{className:"rvap-card-head",children:[(0,n.jsx)("div",{className:"rvap-avatar",children:"\ud83d\udc64"}),(0,n.jsxs)("div",{className:"rvap-meta",children:[(0,n.jsx)("div",{className:"rvap-user",children:a.userName}),(0,n.jsx)("div",{className:"rvap-date",children:o(a.date)}),(0,n.jsxs)("div",{className:"rvap-stars",children:["\u2605".repeat(Math.max(0,Math.floor(a.rating||0))),"\u2606".repeat(Math.max(0,5-Math.floor(a.rating||0)))]})]})]}),(0,n.jsx)("div",{className:"rvap-text",children:a.text}),Array.isArray(a.images)&&a.images.length>0&&(0,n.jsx)("div",{className:"rvap-images",children:a.images.map((e,s)=>(0,n.jsx)("img",{src:e,alt:"review-".concat(a.id,"-").concat(s)},s))}),(0,n.jsx)("div",{className:"rvap-actions",children:"APPROVED"===a.status?(0,n.jsx)("span",{className:"rvap-chip ok",children:"\uc2b9\uc778\ub428"}):"REJECTED"===a.status?(0,n.jsx)("span",{className:"rvap-chip danger",children:"\ube44\uc2b9\uc778"}):(0,n.jsx)("button",{type:"button",className:"rvap-btn",onClick:e=>{e.stopPropagation(),U(a)},children:"\uac80\uc218"})})]},a.id))}),C&&R&&(0,n.jsx)("div",{className:"rvap-modal-backdrop",onClick:()=>!G&&J(),children:(0,n.jsxs)("div",{className:"rvap-modal",onClick:a=>a.stopPropagation(),children:[(0,n.jsxs)("div",{className:"rvap-modal-header",children:[(0,n.jsx)("h3",{className:"rvap-modal-title",children:"\ub9ac\ubdf0 \uc0c1\uc138"}),(0,n.jsx)("button",{type:"button",className:"rvap-modal-close","aria-label":"\ub2eb\uae30",onClick:()=>!G&&J()})]}),(0,n.jsxs)("div",{className:"rvap-modal-body",children:[(0,n.jsxs)("div",{className:"rvap-detail-head",children:[(0,n.jsxs)("div",{className:"rvap-detail-user",children:[(0,n.jsx)("div",{className:"rvap-avatar md",children:"\ud83d\udc64"}),(0,n.jsxs)("div",{className:"rvap-detail-meta",children:[(0,n.jsx)("div",{className:"rvap-user",children:R.userName}),(0,n.jsx)("div",{className:"rvap-date",children:o(R.date)})]})]}),(0,n.jsxs)("div",{className:"rvap-detail-stars","aria-label":"\ubcc4\uc810 ".concat(R.rating,"\uc810"),children:["\u2605".repeat(Math.max(0,Math.floor(R.rating||0))),"\u2606".repeat(Math.max(0,5-Math.floor(R.rating||0)))]})]}),(0,n.jsx)("div",{className:"rvap-detail-text",children:R.text||(0,n.jsx)("span",{className:"rvap-muted",children:"\ub0b4\uc6a9 \uc5c6\uc74c"})}),Array.isArray(R.images)&&R.images.length>0&&(0,n.jsx)("div",{className:"rvap-detail-images",children:R.images.map((a,e)=>(0,n.jsx)("img",{src:a,alt:"detail-".concat(R.id,"-").concat(e)},e))})]}),(0,n.jsxs)("div",{className:"rvap-modal-actions",children:[(0,n.jsx)("button",{className:"rvap-btn ghost",onClick:()=>!G&&J(),children:"\ub2eb\uae30"}),"PENDING"===R.status?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"rvap-btn danger",disabled:G,onClick:async()=>{if(R)try{M(!0);const a=c.reviewReject(R.id);await L(a.url,a.config),y(a=>a.map(a=>a.id===R.id?(0,l.A)((0,l.A)({},a),{},{status:"REJECTED"}):a)),k("APPROVED"),J(),alert("\ube44\uc2b9\uc778 \ucc98\ub9ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(s){var a,e;const t=(null===s||void 0===s||null===(a=s.response)||void 0===a||null===(e=a.data)||void 0===e?void 0:e.message)||(null===s||void 0===s?void 0:s.message)||"\ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(t)}finally{M(!1)}},children:G?"\ucc98\ub9ac \uc911\u2026":"\ube44\uc2b9\uc778"}),(0,n.jsx)("button",{className:"rvap-btn ok",disabled:G,onClick:async()=>{if(R)try{if(M(!0),"APPROVED"!==R.status){const a=c.reviewApprove(R.id);await L(a.url,a.config)}y(a=>a.map(a=>a.id===R.id?(0,l.A)((0,l.A)({},a),{},{status:"APPROVED"}):a)),k("APPROVED"),J(),alert("\uc2b9\uc778 \ucc98\ub9ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(s){var a,e;const t=(null===s||void 0===s||null===(a=s.response)||void 0===a||null===(e=a.data)||void 0===e?void 0:e.message)||(null===s||void 0===s?void 0:s.message)||"\ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(t)}finally{M(!1)}},children:G?"\ucc98\ub9ac \uc911\u2026":"\uc2b9\uc778"})]}):"REJECTED"===R.status?(0,n.jsx)("span",{className:"rvap-chip danger",children:"\ube44\uc2b9\uc778\ub428"}):(0,n.jsx)("span",{className:"rvap-chip ok",children:"\uc2b9\uc778\ub428"})]})]})})]})}function u(){return(0,n.jsx)("div",{"data-app":"map",children:(0,n.jsxs)(t.BV,{children:[(0,n.jsx)(t.qh,{index:!0,element:(0,n.jsx)(v,{})}),(0,n.jsx)(t.qh,{path:"*",element:(0,n.jsx)(t.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=486.e0c4cb77.chunk.js.map